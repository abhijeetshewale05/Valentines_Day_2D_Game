<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Milk & Mocha Quest</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@700&family=Dancing+Script:wght@700&display=swap');
        
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; touch-action: none; user-select: none; }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #000;
            font-family: 'Quicksand', sans-serif; position: fixed; 
        }
        
        #game-container { 
            position: relative; width: 100vw; height: 100vh; 
            display: flex; justify-content: center; align-items: center;
            background: #fff1f2;
        }

        /* Screen Overlays - Redesigned for Mobile Clarity */
        .screen {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            z-index: 100; text-align: center; 
            padding-top: 5vh; /* Starts higher up */
        }
        
        #intro-screen { background: linear-gradient(135deg, #ffafbd 0%, #ffc3a0 100%); z-index: 120; }
        #game-over-screen { background: #fdf2f7; display: none; z-index: 140; }
        #victory-screen { background: #fffafa; display: none; z-index: 130; }

        /* Smaller, sharper GIFs for mobile visibility */
        .gif-container {
            width: 160px; /* Reduced width to prevent cutting */
            border-radius: 15px; overflow: hidden; 
            border: 4px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 10px 0;
        }

        .heart-btn {
            background: #ff4d6d; width: 110px; height: 90px; border: none; cursor: pointer;
            clip-path: path('M55 85s-45-28-45-60c0-22 15-28 22-28 12 0 23 12 23 12s10-12 23-12c10 0 22 5 22 28 0 32-45 60-45 60z');
            color: white; font-family: 'Fredoka One'; font-size: 14px; 
            display: flex; align-items: center; justify-content: center;
            padding-bottom: 20px; margin-top: 10px;
        }

        /* Mobile Controls - Set to 30% from bottom as requested */
        #mobile-controls {
            position: absolute; bottom: 30%; 
            left: 0; width: 100%; height: 80px;
            display: none; z-index: 150; pointer-events: none;
        }
        .btn-l { position: absolute; left: 10%; pointer-events: auto; }
        .btn-r { position: absolute; left: 28%; pointer-events: auto; }
        .btn-j { position: absolute; right: 12%; pointer-events: auto; }

        .control-btn {
            width: 75px; height: 75px; background: rgba(255, 255, 255, 0.5);
            border: 3px solid #ff4d6d; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 32px; color: #ff4d6d; font-weight: bold;
        }

        canvas { 
            display: none; 
            max-width: 100%; max-height: 100%; 
            object-fit: contain; 
        }

        #landscape-warning {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #ff4d6d; color: white; z-index: 1000;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        @media screen and (orientation: portrait) { #landscape-warning { display: flex; } }
    </style>
</head>
<body>

<div id="landscape-warning">
    <div style="font-size: 50px;">üîÑ</div>
    <h2 style="font-family:'Fredoka One'">Please Rotate Phone!</h2>
</div>

<div id="game-container">
    <div id="intro-screen" class="screen">
        <h1 style="font-family:'Fredoka One'; color:white; text-shadow:2px 2px 0 #ff4d6d; font-size:1.8rem;">Bear & Panda Quest</h1>
        <div class="gif-container">
            <div class="tenor-gif-embed" data-postid="1407182070087662632" data-share-method="host" data-aspect-ratio="1" data-width="100%"><a href="https://tenor.com/view/ily-milo-milo-i-love-you-i-love-you-so-much-i-love-you-very-much-gif-1407182070087662632">Ily Milo GIF</a></div>
            <script type="text/javascript" async src="https://tenor.com/embed.js"></script>
        </div>
        <button class="heart-btn" onclick="startGame()">START</button>
    </div>

    <div id="game-over-screen" class="screen">
        <div style="font-family:'Fredoka One'; color:#ff4d6d; font-size:1.4rem;">Don't let go... ü•∫</div>
        <div class="gif-container" style="width: 120px;">
            <div class="tenor-gif-embed" data-postid="27491908" data-share-method="host" data-aspect-ratio="0.5625" data-width="100%"><a href="https://tenor.com/view/milk-and-mocha-milk-mocha-bear-love-love-you-gif-27491908">Milk And Mocha GIF</a></div>
            <script type="text/javascript" async src="https://tenor.com/embed.js"></script>
        </div>
        <button class="heart-btn" onclick="location.reload()">RETRY</button>
    </div>

    <div id="victory-screen" class="screen">
        <div class="gif-container" style="width:180px;">
            <div class="tenor-gif-embed" data-postid="20721043" data-share-method="host" data-aspect-ratio="1" data-width="100%"><a href="https://tenor.com/view/cheriuzzina-gif-20721043">Cheriuzzina Sticker</a></div>
            <script type="text/javascript" async src="https://tenor.com/embed.js"></script>
        </div>
        <div style="font-family:'Dancing Script'; color:#ff4d6d; font-size:1.4rem; padding: 5px 20px;">I love you chotuuuuu, Happy Valentines Day my sunflower! üåªüíñ</div>
        <button class="heart-btn" onclick="location.reload()">AGAIN</button>
    </div>

    <div id="mobile-controls">
        <div class="control-btn btn-l" id="lBtn">‚Üê</div>
        <div class="control-btn btn-r" id="rBtn">‚Üí</div>
        <div class="control-btn btn-j" id="jBtn">‚Üë</div>
    </div>
    <canvas id="gameCanvas"></canvas>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const controls = document.getElementById('mobile-controls');

const GRAVITY = 0.5;
const WORLD_WIDTH = 4000;
const V_HEIGHT = 600; 
let gameActive = false, gameFrame = 0, cameraX = 0;

// Bear spawned HIGHER UP
const bear = { x: 250, y: 250, w: 60, h: 55, dy: 0, jCount: 0, speed: 7.5 };
const panda = { x: 3750, y: 290, w: 70, h: 65 };

// Platforms shifted UP by 150px total to be in the top half of screen
const platforms = [
    {x: 0, y: 400, w: 1000, h: 100}, {x: 1200, y: 270, w: 350, h: 40},
    {x: 1700, y: 170, w: 250, h: 40}, {x: 2100, y: 300, w: 400, h: 40},
    {x: 2600, y: 200, w: 300, h: 40}, {x: 3050, y: 330, w: 400, h: 40},
    {x: 3550, y: 400, w: 700, h: 100}
];
const hearts = [{x: 1300, y: 200}, {x: 1800, y: 90}, {x: 2300, y: 220}, {x: 2750, y: 120}, {x: 3200, y: 250}].map(h => ({...h, collected: false}));
const wolves = [{x: 1400, y: 225, startX: 1400, range: 120, dir: 1}, {x: 2200, y: 255, startX: 2200, range: 160, dir: 1}, {x: 3100, y: 285, startX: 3100, range: 200, dir: 1}];

const keys = {};
const touch = { l: false, r: false };

window.addEventListener('keydown', e => { keys[e.code] = true; if(e.code==='Space'||e.code==='ArrowUp') jump(); });
window.addEventListener('keyup', e => keys[e.code] = false);

function setupBtn(id, act) {
    const b = document.getElementById(id);
    b.addEventListener('touchstart', (e) => { e.preventDefault(); if(act==='j') jump(); else touch[act]=true; }, {passive: false});
    b.addEventListener('touchend', (e) => { e.preventDefault(); if(act!=='j') touch[act]=false; }, {passive: false});
}
setupBtn('lBtn', 'l'); setupBtn('rBtn', 'r'); setupBtn('jBtn', 'j');

function jump() { if(bear.jCount < 2 && gameActive) { bear.dy = -13.5; bear.jCount++; } }

function drawHeart(x, y) {
    const b = Math.sin(gameFrame * 0.05) * 5;
    ctx.fillStyle = "#ff4d6d"; ctx.beginPath(); ctx.moveTo(x, y+b);
    ctx.bezierCurveTo(x, y-15+b, x-20, y-15+b, x-20, y+b);
    ctx.bezierCurveTo(x-20, y+20+b, x, y+25+b, x, y+35+b);
    ctx.bezierCurveTo(x, y+25+b, x+20, y+20+b, x+20, y+b);
    ctx.bezierCurveTo(x+20, y-15+b, x, y-15+b, x, y+b); ctx.fill();
}

function drawBear(x, y) {
    ctx.fillStyle = '#b19688'; ctx.beginPath(); ctx.roundRect(x, y, 60, 55, 20); ctx.fill();
    ctx.beginPath(); ctx.arc(x+10, y+5, 14, 0, 7); ctx.arc(x+50, y+5, 14, 0, 7); ctx.fill();
    ctx.fillStyle = '#ffcdd2'; ctx.beginPath(); ctx.arc(x+12, y+35, 8, 0, 7); ctx.arc(x+48, y+35, 8, 0, 7); ctx.fill();
    ctx.fillStyle = '#3e2723'; ctx.beginPath(); ctx.arc(x+22, y+25, 3.5, 0, 7); ctx.arc(x+38, y+25, 3.5, 0, 7); ctx.fill();
}

function drawPanda(x, y) {
    ctx.fillStyle = 'white'; ctx.beginPath(); ctx.roundRect(x, y, 70, 65, 25); ctx.fill();
    ctx.fillStyle = '#2d2d2d'; ctx.beginPath(); ctx.arc(x+15, y+5, 16, 0, 7); ctx.arc(x+55, y+5, 16, 0, 7); ctx.fill();
    ctx.beginPath(); ctx.ellipse(x+25, y+30, 12, 14, 0.2, 0, 7); ctx.ellipse(x+45, y+30, 12, 14, -0.2, 0, 7); ctx.fill();
    ctx.fillStyle = '#f8bbd0'; ctx.beginPath(); ctx.arc(x+12, y+45, 8, 0, 7); ctx.arc(x+58, y+45, 8, 0, 7); ctx.fill();
}

function drawWolf(x, y) {
    ctx.fillStyle = '#78909c'; ctx.beginPath(); ctx.roundRect(x, y, 55, 45, 15); ctx.fill();
    ctx.fillStyle = 'red'; ctx.beginPath(); ctx.arc(x+18, y+20, 3, 0, 7); ctx.arc(x+38, y+20, 3, 0, 7); ctx.fill();
}

function resize() {
    const scale = window.innerHeight / V_HEIGHT;
    canvas.height = V_HEIGHT; canvas.width = window.innerWidth / scale;
}
window.addEventListener('resize', resize);

function startGame() {
    document.getElementById('intro-screen').style.display = 'none';
    canvas.style.display = 'block';
    if(window.innerWidth < 1024) controls.style.display = 'block';
    resize(); gameActive = true; loop();
}

function loop() {
    if (!gameActive) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height); gameFrame++;
    cameraX = bear.x - canvas.width / 3; if (cameraX < 0) cameraX = 0;
    ctx.save(); ctx.translate(-cameraX, 0);
    ctx.fillStyle = '#a5d6a7'; platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));
    hearts.forEach(h => { if (!h.collected) { drawHeart(h.x, h.y); if (Math.hypot(bear.x+30-h.x, bear.y+25-h.y) < 55) h.collected = true; } });
    wolves.forEach(w => {
        w.x += w.dir * 1.8; if (Math.abs(w.x-w.startX) > w.range) w.dir *= -1;
        drawWolf(w.x, w.y); if (Math.hypot(bear.x+30-(w.x+27), bear.y+25-(w.y+22)) < 48) end('game-over-screen');
    });
    if (keys['ArrowRight'] || keys['KeyD'] || touch.r) bear.x += bear.speed;
    if (keys['ArrowLeft'] || keys['KeyA'] || touch.l) bear.x -= bear.speed;
    bear.dy += GRAVITY; bear.y += bear.dy;
    platforms.forEach(p => { if (bear.x+45 > p.x && bear.x < p.x+p.w && bear.y+55 > p.y && bear.y+55 < p.y+p.h+20 && bear.dy >= 0) { bear.y = p.y-55; bear.dy = 0; bear.jCount = 0; } });
    if (bear.y > V_HEIGHT) end('game-over-screen');
    if (bear.x > panda.x - 30) end('victory-screen');
    drawPanda(panda.x, panda.y); drawBear(bear.x, bear.y); ctx.restore(); requestAnimationFrame(loop);
}
function end(id) { gameActive = false; canvas.style.display='none'; controls.style.display='none'; document.getElementById(id).style.display='flex'; }
</script>
</body>
</html>
